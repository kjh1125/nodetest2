<!DOCTYPE html>
<html>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <head>
         <!-- include 이용하여 수정 시 한 번 수정으로 활용가능  -->
    <% include ./head.ejs%>
  </head>
  <form name="f">
  <body>
   
    <table border="1"> 
        <tr>
            <td colspan="6" style="text-align:right">
            <select name="sel">
                <option value="1">제목</option>
                <option value="2">작성자</option>
                <option value="3">내용</option>
                </select>
                <input type=text name="search" value=""> <input type="button" onclick="search1()" value="검색">
            </td>
        </tr>
        <tr style="text-align:center">
            <td>번호</td>
            <td>제목</td>
            <td>작성자</td>
            <td>내용</td>
            <td>수정</td>
            <td>삭제</td>
        </tr>
        <%
        var num = 1;
        for (var i=0; i<data.length; i++){
            %>
        <tr>
            <td><%=num%></td>
            <td><%=data[i].subject%></td> 
            <td><%=data[i].writer%></td>
            <td><%=data[i].content%></td>
            <td><input type="button" value="수정" onclick="edit('<%=data[i].idx%>')"></td> 
            <td><input type="button" value="삭제" onclick="del('<%=data[i].idx%>')"></td>
        </tr>
    <%
    num++;
    }
    %>
     
    
    <tr>
        <td colspan="6" style="text-align:right">
            <a href="./write"><b>글쓰기</b></a>
        </td>
    </tr>
    <tr>
        <td colspan="6" style="text-align:center">
            <li style="list-style-type: none;" onclick="search1(1)">1</li>
        </td>
    </tr>
</table>
   
</body>
</form>
</html>

<script>

function del(id){
	
    console.log(id);
    var aj;
    function wck(){
       if(window.XMLHttpRequest){
              return new XMLHttpRequest();
          }
    }
    function acall(){
       if(aj.readyState == XMLHttpRequest.DONE && aj.status==200){   

           alert("삭제완료");
           location.reload();
    
       }
    }
   
    var gopage = "./del?id="+id;
    aj = wck();
    aj.onreadystatechange = acall;
    aj.open("get",gopage,true);
    aj.send();
}

function edit(id){
location.href="./update?id="+id;

}

function search1(page){
if(page==undefined){
    page=1;
}
location.href = `./index?search=${f.search.value}&sel=${f.sel.value}&page=${page}`; //get으로 전송하기 위한 코드 
}

</script>
